در rootModule اقدام به برقراری ارتباط با ماژول مورد نظرمون می کنیم:

![](Pasted%20image%2020240310195804.png)

وقتی تو حالت `dev` هستیم `synchronize: true` روشن باشد اما در حالت `production` باید اونو خاموش کنیم.

![](Pasted%20image%2020240310200101.png)

در حالت عادی هر نامی که entity class ما داشته باشه lowerCase میشه و به عنوان نام Table در database در نظر گرفته میشه ، اگه بخوایم نام دیگه ای برای table مون در نظر بگیریم بصورت پایین عمل می کنیم:

![](Pasted%20image%2020240310200255.png)

حالا در گام بعد باید `column` های جدول coffee رو مشخص کنیم ؛ با استفاده از دکوراتور `@PrimaryGeneratedColumn()` برای property ی id و دکوراتور `@Column()` بقیه property ها و  می تونیم ستون های جدولمون رو مشخص کنیم:

![](Pasted%20image%2020240310200910.png)

![](Pasted%20image%2020240310200925.png)

![](Pasted%20image%2020240310200953.png)

همه column ها بصورت پیش فرض `required` هستند.

حالا باید جدول مورد نظرمون رو در module مربوطه ثبت کنیم:

![](Pasted%20image%2020240310201412.png)

حالا جدول coffee در دیتابیس یه همچین شکلی خواهد داشت:
![](Pasted%20image%2020240310201449.png)


این typeORM از repository پشتیبانی می کنه ، به این معنا که هر enitity که می سازیم repository مربوط به خودشو خواهد داشت.


![](Pasted%20image%2020240310202857.png)

در واقع Repository یه abstract (انتزاع) از Data Source بوجود آورده و دارای متد های کاربردی فراوانی هست.

با تزریق repository به class service مربوطه می تونیم از متد های repository استفاده کنیم.
برای تزریق Repository از دکوراتور `@InjectRepository(name of entity)` استفاده می کنیم:

![](Pasted%20image%2020240310203214.png)

![](Pasted%20image%2020240310203529.png)

![](Pasted%20image%2020240310203619.png)

![](Pasted%20image%2020240310203734.png)

![](Pasted%20image%2020240310203914.png)

متد `preload` اگر بتونه enitity مربوطه رو با توجه به id که بهش می دیم پیدا کنه کل enitiy ی coffee رو بر میگردونه و اگر نتونه براساس id داده شده چیزی پیدا کنه `undefined` بر میگردونه

>[!tip]
>زمانی که تغییری روی یه entity می دیم ، برای اینکه این تغییر در دیتابیس ثبت بشه از متد `save()` استفاده می کنیم و زمانی که entity ای رو حذف می کنیم باید متد `remove()` رو صدا بزنیم.


![](Pasted%20image%2020240310204347.png)

دقت کنید که متد `findOne()` در خط 44 ، همان متد `findOne()` کلاس CoffeeService هست.

انواع relation بین دو جدول--------------

ارتباط 1 به 1

![](Pasted%20image%2020240310205309.png)

در typeORM برای نشان دادن این نوع ارتباط از دکوراتور `@OneToOne()` استفاده می کنیم.

ارتباط 1 به چند

![](Pasted%20image%2020240310205743.png)

در typeORM برای نشان دادن این نوع از ارتباط از دکوراتور `@OneToMany()` و `@ManyToOne()` استفاده میشه.

ارتباط چند به چند

![](Pasted%20image%2020240310210555.png)

در typeORM برای نشان دادن این نوع از ارتباط از دکوراتور `@ManyToMany()` استفاده میشه.

حالا بیاین طعم و مزه کافی (Flavor) رو یه جدول جدا در نظر بگیریم ، پس یه entity تحت عنوان flavor.entity می سازیم:

![](Pasted%20image%2020240310211017.png)

![](Pasted%20image%2020240310211143.png)
![](Pasted%20image%2020240310212231.png)

دکوراتور `@JoinToTable()` مالک رابطه رو مشخص میکنه

![](Pasted%20image%2020240310212640.png)

حالا باید موجودیت `Flavor` رو بوسیله `TypeOrmModule`  در `CoffeeModule` ثبت (register) کنیم:

![](Pasted%20image%2020240310212848.png)

حالا وقتی برنامه رو run می کنیم ، جدول زیر در دیتابیس مربوطه ایجاد میشه:

![](Pasted%20image%2020240310212957.png)

نکته اینجاست که چون رابطه از نوع چند به چند بوده ، یه جدول سومی هم ایجاد میشه:

![](Pasted%20image%2020240310213111.png)

گفته میشه این جدول رو در حالت production غیر فعال کرد که ساخته نشه !! منظورشو نفهمیدم.


![](Pasted%20image%2020240310213944.png)

حالا اگه request ای ارسال کنیم که لیست coffee ها رو بگیریم ، flavors رو نخواهیم داشت ، برای رفع این مسئله یه option باید به متد های repository اضافه کنیم:


![](Pasted%20image%2020240310213846.png)

![](Pasted%20image%2020240310213856.png)

حالا اگه یه بار دیگه request بزنیم flavors رو هم خواهیم داشت:

![](Pasted%20image%2020240310214017.png)

